<IfModule mod_rewrite.c>
  RewriteEngine On
  RewriteBase /

  # Habilitar CORS para todas las solicitudes
  <IfModule mod_headers.c>
    Header set Access-Control-Allow-Origin "*"
    Header set Access-Control-Allow-Methods "GET, POST, PUT, DELETE, OPTIONS"
    Header set Access-Control-Allow-Headers "Origin, X-Requested-With, Content-Type, Accept, Authorization"

    # Manejar solicitudes OPTIONS para CORS preflight
    RewriteCond %{REQUEST_METHOD} OPTIONS
    RewriteRule ^(.*)$ $1 [R=200,L]
  </IfModule>

  # Redirigir todas las solicitudes a HTTPS si no lo están ya
  RewriteCond %{HTTPS} off
  RewriteRule ^ https://%{HTTP_HOST}%{REQUEST_URI} [L,R=301]

  # Si el archivo o directorio existe, úsalo directamente
  RewriteCond %{REQUEST_FILENAME} -f [OR]
  RewriteCond %{REQUEST_FILENAME} -d
  RewriteRule ^ - [L]

  # Manejar rutas de Next.js para SPA
  # Si la solicitud es para un archivo estático, ignorar
  RewriteCond %{REQUEST_URI} !^/_next/(.*)$
  RewriteCond %{REQUEST_URI} !^/images/(.*)$
  RewriteCond %{REQUEST_URI} !^/sounds/(.*)$
  RewriteCond %{REQUEST_URI} !\.(html|js|css|png|jpg|jpeg|gif|svg|ico|woff|woff2|ttf|eot|otf|map|json|xml|txt|mp3|mp4|webm|ogg|pdf|zip|gz)$

  # Para rutas específicas, servir el HTML correspondiente
  RewriteRule ^login/?$ /login/index.html [L]
  RewriteRule ^register/?$ /register/index.html [L]
  RewriteRule ^dashboard/?$ /dashboard/index.html [L]
  RewriteRule ^dashboard/trabajadores/?$ /dashboard/trabajadores/index.html [L]
  RewriteRule ^dashboard/trabajadores/nuevo/?$ /dashboard/trabajadores/nuevo/index.html [L]
  RewriteRule ^dashboard/contratos/?$ /dashboard/contratos/index.html [L]
  RewriteRule ^dashboard/contratos/nuevo/?$ /dashboard/contratos/nuevo/index.html [L]

  # Para cualquier otra ruta que no sea un archivo o directorio existente, servir index.html
  RewriteRule ^ /index.html [L]

  # Prevenir listado de directorios
  Options -Indexes

  # Comprimir archivos para mejorar el rendimiento
  <IfModule mod_deflate.c>
    AddOutputFilterByType DEFLATE text/html text/plain text/xml text/css text/javascript application/javascript application/x-javascript application/json
  </IfModule>

  # Configurar caché del navegador para archivos estáticos
  <IfModule mod_expires.c>
    ExpiresActive On
    ExpiresByType image/jpg "access plus 1 year"
    ExpiresByType image/jpeg "access plus 1 year"
    ExpiresByType image/gif "access plus 1 year"
    ExpiresByType image/png "access plus 1 year"
    ExpiresByType image/svg+xml "access plus 1 year"
    ExpiresByType text/css "access plus 1 month"
    ExpiresByType application/pdf "access plus 1 month"
    ExpiresByType text/javascript "access plus 1 month"
    ExpiresByType application/javascript "access plus 1 month"
    ExpiresByType application/x-javascript "access plus 1 month"
    ExpiresByType application/x-font-woff "access plus 1 year"
    ExpiresByType application/x-font-woff2 "access plus 1 year"
    ExpiresByType application/font-woff "access plus 1 year"
    ExpiresByType application/font-woff2 "access plus 1 year"
    ExpiresByType font/woff "access plus 1 year"
    ExpiresByType font/woff2 "access plus 1 year"
    ExpiresByType application/x-font-ttf "access plus 1 year"
    ExpiresByType font/ttf "access plus 1 year"
    ExpiresByType font/otf "access plus 1 year"
    ExpiresByType application/x-font-otf "access plus 1 year"
    ExpiresByType audio/ogg "access plus 1 month"
    ExpiresByType audio/mp3 "access plus 1 month"
    ExpiresByType video/mp4 "access plus 1 month"
    ExpiresByType video/webm "access plus 1 month"
  </IfModule>
</IfModule>
